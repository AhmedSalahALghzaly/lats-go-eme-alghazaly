{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":57},"end":{"line":4,"column":55,"index":112}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"../store/appStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":113},"end":{"line":5,"column":48,"index":161}}],"key":"/bohzyw2mCiLwBL1LhK3cj9dt4o=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){\"use strict\";Object.defineProperty(e,'__esModule',{value:!0}),Object.defineProperty(e,\"default\",{enumerable:!0,get:function(){return l}}),Object.defineProperty(e,\"wsService\",{enumerable:!0,get:function(){return o}}),Object.defineProperty(e,\"useWebSocket\",{enumerable:!0,get:function(){return c}});var t=r(d[0]),n=r(d[1]);const s='ws://localhost:8001';const o=new class{ws=null;reconnectTimeout=null;reconnectAttempts=0;maxReconnectAttempts=5;messageHandlers=new Set;connect(t){if(this.ws?.readyState===WebSocket.OPEN)return;const n=t?`${s}/api/ws?user_id=${t}`:`${s}/api/ws`;try{this.ws=new WebSocket(n),this.ws.onopen=()=>{console.log('[WS] Connected'),this.reconnectAttempts=0},this.ws.onmessage=t=>{try{const n=JSON.parse(t.data);console.log('[WS] Message:',n),this.messageHandlers.forEach(t=>t(n))}catch(t){console.error('[WS] Parse error:',t)}},this.ws.onerror=t=>{console.error('[WS] Error:',t)},this.ws.onclose=()=>{console.log('[WS] Disconnected'),this.scheduleReconnect(t)}}catch(n){console.error('[WS] Connection error:',n),this.scheduleReconnect(t)}}scheduleReconnect(t){if(this.reconnectAttempts>=this.maxReconnectAttempts)return void console.log('[WS] Max reconnect attempts reached');this.reconnectTimeout&&clearTimeout(this.reconnectTimeout);const n=Math.min(1e3*Math.pow(2,this.reconnectAttempts),3e4);this.reconnectAttempts++,this.reconnectTimeout=setTimeout(()=>{console.log(`[WS] Reconnecting (attempt ${this.reconnectAttempts})...`),this.connect(t)},n)}disconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.ws&&(this.ws.close(),this.ws=null)}send(t){this.ws?.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(t))}addMessageHandler(t){return this.messageHandlers.add(t),()=>this.messageHandlers.delete(t)}isConnected(){return this.ws?.readyState===WebSocket.OPEN}},c=()=>{const s=(0,n.useAppStore)(t=>t.user),c=(0,n.useAppStore)(t=>t.addNotification),l=(0,n.useAppStore)(t=>t.setSyncStatus),u=(0,n.useAppStore)(t=>t.fetchInitialData);(0,t.useEffect)(()=>{o.connect(s?.id);const t=o.addMessageHandler(t=>{switch(t.type){case'notification':t.data&&c({id:t.data.id||`notif-${Date.now()}`,title:t.data.title,message:t.data.message,type:t.data.type||'info',read:!1,created_at:t.data.created_at||(new Date).toISOString()});break;case'sync':l('syncing'),u?.().then(()=>{l('success'),setTimeout(()=>l('idle'),2e3)}).catch(()=>{l('error')});break;case'ping':o.send({type:'pong'});break;default:console.log('[WS] Unknown message type:',t.type)}});return()=>{t(),o.disconnect()}},[s?.id]);const h=(0,t.useCallback)(t=>{o.send(t)},[]);return{isConnected:o.isConnected(),sendMessage:h}};var l=o});","lineCount":1,"map":[[1,90,168,0,"Object"],[1,97,168,0,"defineProperty"],[1,112,168,0,"e"],[1,114,168,0],[1,125,168,0,"enumerable"],[1,137,168,0],[1,139,168,0,"get"],[1,143,168,0],[1,161,168,0,"_default"],[1,162,168,0],[1,166,102,0,"Object"],[1,173,102,0,"defineProperty"],[1,188,102,0,"e"],[1,190,102,0],[1,203,102,0,"enumerable"],[1,215,102,0],[1,217,102,0,"get"],[1,221,102,0],[1,239,102,0,"wsService"],[1,240,102,0],[1,244,105,0,"Object"],[1,251,105,0,"defineProperty"],[1,266,105,0,"e"],[1,268,105,0],[1,284,105,0,"enumerable"],[1,296,105,0],[1,298,105,0,"get"],[1,302,105,0],[1,320,105,0,"useWebSocket"],[1,321,105,0],[1,325,4,0],[1,329,4,0,"_react"],[1,331,4,0,"r"],[1,333,4,0,"d"],[1,335,4,0],[1,339,5,0,"_storeAppStore"],[1,341,5,0,"r"],[1,343,5,0,"d"],[1,345,5,0],[1,349,7,0],[1,355,7,6,"WS_URL"],[1,357,7,74],[1,379,102,7],[1,385,102,13,"wsService"],[1,387,102,25],[1,391,9,0],[1,397,10,10,"ws"],[1,400,10,33],[1,405,11,10,"reconnectTimeout"],[1,422,11,52],[1,427,12,10,"reconnectAttempts"],[1,445,12,30],[1,447,13,10,"maxReconnectAttempts"],[1,468,13,33],[1,470,14,10,"messageHandlers"],[1,486,14,54],[1,490,14,58,"Set"],[1,494,16,2,"connect"],[1,502,16,10,"userId"],[1,505,17,4],[1,508,17,8,"this"],[1,513,17,13,"ws"],[1,517,17,17,"readyState"],[1,530,17,32,"WebSocket"],[1,540,17,42,"OPEN"],[1,545,18,6],[1,552,21,4],[1,558,21,10,"url"],[1,560,21,16,"userId"],[1,562,21,25],[1,565,21,28,"WS_URL"],[1,585,21,53,"userId"],[1,589,21,64],[1,592,21,67,"WS_URL"],[1,603,23,4],[1,607,24,6,"this"],[1,612,24,11,"ws"],[1,615,24,16],[1,619,24,20,"WebSocket"],[1,629,24,30,"url"],[1,632,26,6,"this"],[1,637,26,11,"ws"],[1,640,26,14,"onopen"],[1,647,26,23],[1,652,27,8,"console"],[1,660,27,16,"log"],[1,664,27,20],[1,682,28,8,"this"],[1,687,28,13,"reconnectAttempts"],[1,705,28,33],[1,708,31,6,"this"],[1,713,31,11,"ws"],[1,716,31,14,"onmessage"],[1,726,31,27,"event"],[1,730,32,8],[1,734,33,10],[1,740,33,16,"data"],[1,742,33,23,"JSON"],[1,747,33,28,"parse"],[1,753,33,34,"event"],[1,755,33,40,"data"],[1,761,34,10,"console"],[1,769,34,18,"log"],[1,773,34,22],[1,789,34,39,"data"],[1,792,35,10,"this"],[1,797,35,15,"messageHandlers"],[1,813,35,31,"forEach"],[1,821,35,39,"handler"],[1,824,35,50,"handler"],[1,826,35,58,"data"],[1,829,36,8],[1,830,36,10],[1,836,36,17,"err"],[1,839,37,10,"console"],[1,847,37,18,"error"],[1,853,37,24],[1,873,37,45,"err"],[1,875,38,8],[1,878,41,6,"this"],[1,883,41,11,"ws"],[1,886,41,14,"onerror"],[1,894,41,25,"error"],[1,898,42,8,"console"],[1,906,42,16,"error"],[1,912,42,22],[1,926,42,37,"error"],[1,930,45,6,"this"],[1,935,45,11,"ws"],[1,938,45,14,"onclose"],[1,946,45,24],[1,951,46,8,"console"],[1,959,46,16,"log"],[1,963,46,20],[1,984,47,8,"this"],[1,989,47,13,"scheduleReconnect"],[1,1007,47,31,"userId"],[1,1010,49,4],[1,1011,49,6],[1,1017,49,13,"err"],[1,1020,50,6,"console"],[1,1028,50,14,"error"],[1,1034,50,20],[1,1059,50,46,"err"],[1,1062,51,6,"this"],[1,1067,51,11,"scheduleReconnect"],[1,1085,51,29,"userId"],[1,1087,52,4],[1,1088,53,2],[1,1089,55,10,"scheduleReconnect"],[1,1107,55,28,"userId"],[1,1110,56,4],[1,1113,56,8,"this"],[1,1118,56,13,"reconnectAttempts"],[1,1137,56,34,"this"],[1,1142,56,39,"maxReconnectAttempts"],[1,1163,58,6],[1,1175,57,6,"console"],[1,1183,57,14,"log"],[1,1187,57,18],[1,1226,61,8,"this"],[1,1231,61,13,"reconnectTimeout"],[1,1249,62,6,"clearTimeout"],[1,1262,62,19,"this"],[1,1267,62,24,"reconnectTimeout"],[1,1285,65,4],[1,1291,65,10,"delay"],[1,1293,65,18,"Math"],[1,1298,65,23,"min"],[1,1302,65,27],[1,1306,65,34,"Math"],[1,1311,65,39,"pow"],[1,1315,65,43],[1,1317,65,46,"this"],[1,1322,65,51,"reconnectAttempts"],[1,1341,65,71],[1,1346,66,4,"this"],[1,1351,66,9,"reconnectAttempts"],[1,1371,68,4,"this"],[1,1376,68,9,"reconnectTimeout"],[1,1393,68,28,"setTimeout"],[1,1404,68,39],[1,1409,69,6,"console"],[1,1417,69,14,"log"],[1,1421,69,18],[1,1451,69,48,"this"],[1,1456,69,53,"reconnectAttempts"],[1,1481,70,6,"this"],[1,1486,70,11,"connect"],[1,1494,70,19,"userId"],[1,1498,71,7,"delay"],[1,1500,72,2],[1,1501,74,2,"disconnect"],[1,1514,75,8,"this"],[1,1519,75,13,"reconnectTimeout"],[1,1538,76,6,"clearTimeout"],[1,1551,76,19,"this"],[1,1556,76,24,"reconnectTimeout"],[1,1574,77,6,"this"],[1,1579,77,11,"reconnectTimeout"],[1,1596,77,30],[1,1602,80,8,"this"],[1,1607,80,13,"ws"],[1,1612,81,6,"this"],[1,1617,81,11,"ws"],[1,1620,81,14,"close"],[1,1628,82,6,"this"],[1,1633,82,11,"ws"],[1,1636,82,16],[1,1641,84,2],[1,1642,86,2,"send"],[1,1647,86,7,"data"],[1,1650,87,8,"this"],[1,1655,87,13,"ws"],[1,1659,87,17,"readyState"],[1,1672,87,32,"WebSocket"],[1,1682,87,42,"OPEN"],[1,1688,88,6,"this"],[1,1693,88,11,"ws"],[1,1696,88,14,"send"],[1,1701,88,19,"JSON"],[1,1706,88,24,"stringify"],[1,1716,88,34,"data"],[1,1719,90,2],[1,1720,92,2,"addMessageHandler"],[1,1738,92,20,"handler"],[1,1741,94,4],[1,1748,93,4,"this"],[1,1753,93,9,"messageHandlers"],[1,1769,93,25,"add"],[1,1773,93,29,"handler"],[1,1776,94,11],[1,1780,94,17,"this"],[1,1785,94,22,"messageHandlers"],[1,1801,94,38,"delete"],[1,1808,94,45,"handler"],[1,1810,95,2],[1,1811,97,2,"isConnected"],[1,1825,98,4],[1,1832,98,11,"this"],[1,1837,98,16,"ws"],[1,1841,98,20,"readyState"],[1,1854,98,35,"WebSocket"],[1,1864,98,45,"OPEN"],[1,1868,99,2],[1,1871,105,13,"useWebSocket"],[1,1873,105,28,"useWebSocket"],[1,1878,106,2],[1,1884,106,8,"user"],[1,1887,106,15],[1,1889,106,15,"useAppStore"],[1,1891,106,26,"useAppStore"],[1,1904,106,28,"state"],[1,1907,106,38,"state"],[1,1909,106,44,"user"],[1,1915,107,8,"addNotification"],[1,1918,107,26],[1,1920,107,26,"useAppStore"],[1,1922,107,37,"useAppStore"],[1,1935,107,39,"state"],[1,1938,107,49,"state"],[1,1940,107,55,"addNotification"],[1,1957,108,8,"setSyncStatus"],[1,1960,108,24],[1,1962,108,24,"useAppStore"],[1,1964,108,35,"useAppStore"],[1,1977,108,37,"state"],[1,1980,108,47,"state"],[1,1982,108,53,"setSyncStatus"],[1,1997,109,8,"fetchData"],[1,2000,109,20],[1,2002,109,20,"useAppStore"],[1,2004,109,31,"useAppStore"],[1,2017,109,33,"state"],[1,2020,109,43,"state"],[1,2022,109,49,"fetchInitialData"],[1,2041,111,2],[1,2043,111,2,"useEffect"],[1,2045,111,11,"useEffect"],[1,2056,111,12],[1,2061,113,4,"wsService"],[1,2063,113,14,"connect"],[1,2071,113,22,"user"],[1,2074,113,28,"id"],[1,2078,116,4],[1,2084,116,10,"removeHandler"],[1,2086,116,26,"wsService"],[1,2088,116,36,"addMessageHandler"],[1,2106,116,55,"data"],[1,2110,117,6],[1,2117,117,14,"data"],[1,2119,117,19,"type"],[1,2125,118,8],[1,2129,118,13],[1,2144,120,14,"data"],[1,2146,120,19,"data"],[1,2152,121,12,"addNotification"],[1,2154,121,28],[1,2155,122,14,"id"],[1,2158,122,18,"data"],[1,2160,122,23,"data"],[1,2165,122,28,"id"],[1,2169,122,34],[1,2178,122,43,"Date"],[1,2183,122,48,"now"],[1,2191,123,14,"title"],[1,2197,123,21,"data"],[1,2199,123,26,"data"],[1,2204,123,31,"title"],[1,2210,124,14,"message"],[1,2218,124,23,"data"],[1,2220,124,28,"data"],[1,2225,124,33,"message"],[1,2233,125,14,"type"],[1,2238,125,20,"data"],[1,2240,125,25,"data"],[1,2245,125,30,"type"],[1,2251,125,38],[1,2258,126,14,"read"],[1,2264,126,20],[1,2266,127,14,"created_at"],[1,2277,127,26,"data"],[1,2279,127,31,"data"],[1,2284,127,36,"created_at"],[1,2297,127,50],[1,2301,127,54,"Date"],[1,2307,127,61,"toISOString"],[1,2323,130,10],[1,2329,132,8],[1,2333,132,13],[1,2340,134,10,"setSyncStatus"],[1,2342,134,24],[1,2353,135,10,"fetchData"],[1,2359,135,24,"then"],[1,2364,135,29],[1,2369,136,12,"setSyncStatus"],[1,2371,136,26],[1,2382,137,12,"setTimeout"],[1,2393,137,23],[1,2397,137,29,"setSyncStatus"],[1,2399,137,43],[1,2407,137,52],[1,2414,138,13,"catch"],[1,2420,138,19],[1,2425,139,12,"setSyncStatus"],[1,2427,139,26],[1,2438,141,10],[1,2444,143,8],[1,2448,143,13],[1,2455,144,10,"wsService"],[1,2457,144,20,"send"],[1,2462,144,25],[1,2463,144,27,"type"],[1,2468,144,33],[1,2477,145,10],[1,2483,147,8],[1,2491,148,10,"console"],[1,2499,148,18,"log"],[1,2503,148,22],[1,2532,148,52,"data"],[1,2534,148,57,"type"],[1,2543,152,4],[1,2549,152,11],[1,2554,153,6,"removeHandler"],[1,2558,154,6,"wsService"],[1,2560,154,16,"disconnect"],[1,2575,156,5],[1,2576,156,6,"user"],[1,2579,156,12,"id"],[1,2584,158,2],[1,2590,158,8,"sendMessage"],[1,2593,158,22],[1,2595,158,22,"useCallback"],[1,2597,158,33,"useCallback"],[1,2610,158,35,"data"],[1,2614,159,4,"wsService"],[1,2616,159,14,"send"],[1,2621,159,19,"data"],[1,2625,160,5],[1,2629,162,2],[1,2635,162,9],[1,2636,163,4,"isConnected"],[1,2648,163,17,"wsService"],[1,2650,163,27,"isConnected"],[1,2664,164,4,"sendMessage"],[1,2680,168,0],[1,2684,168,0,"_default"],[1,2686,168,15,"wsService"],[1,2687,168,25],[1,2690]],"functionMap":{"names":["<global>","WebSocketService","WebSocketService#connect","ws.onopen","ws.onmessage","messageHandlers.forEach$argument_0","ws.onerror","ws.onclose","WebSocketService#scheduleReconnect","setTimeout$argument_0","WebSocketService#disconnect","WebSocketService#send","WebSocketService#addMessageHandler","<anonymous>","WebSocketService#isConnected","useWebSocket","useAppStore$argument_0","useEffect$argument_0","wsService.addMessageHandler$argument_0","fetchData.then$argument_0","fetchData.then._catch$argument_0","sendMessage"],"mappings":"AAA;ACQ;ECO;uBCU;ODG;0BEE;uCCI,wBD;OFI;wBIE;OJE;wBKE;OLG;GDK;EOE;uCCa;KDG;GPC;ESE;GTU;EUE;GVI;EWE;WCE,0CD;GXC;EaE;GbE;CDC;4BeK;2BCC,qBD;sCCC,gCD;oCCC,8BD;gCCC,iCD;YEE;sDCK;6BCmB;uBVE,2BU;WDC,QE;WFE;KDU;WJE;KIG;GFC;kCME;GNE;CfM"},"hasCjsExports":false},"type":"js/module"}]}