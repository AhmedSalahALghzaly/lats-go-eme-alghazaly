{"dependencies":[{"name":"../store/appStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":98},"end":{"line":5,"column":48,"index":146}}],"key":"/bohzyw2mCiLwBL1LhK3cj9dt4o=","exportNames":["*"],"imports":1}},{"name":"./api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":147},"end":{"line":17,"column":15,"index":325}}],"key":"FbKPDeRJ9TF3vg1eKYKz12urgic=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,_e,d){\"use strict\";Object.defineProperty(_e,'__esModule',{value:!0}),Object.defineProperty(_e,\"default\",{enumerable:!0,get:function(){return n}}),Object.defineProperty(_e,\"syncService\",{enumerable:!0,get:function(){return s}}),Object.defineProperty(_e,\"useSyncService\",{enumerable:!0,get:function(){return c}});var t=r(d[0]),e=r(d[1]);const s=new class{syncInterval=null;isRunning=!1;syncIntervalMs=6e4;start(){this.isRunning||(this.isRunning=!0,console.log('[SyncService] Starting background sync service'),this.performSync(),this.syncInterval=setInterval(()=>{this.performSync()},this.syncIntervalMs))}stop(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null),this.isRunning=!1,console.log('[SyncService] Stopped background sync service')}async performSync(){const s=t.useAppStore.getState();if(s.isOnline)if('syncing'!==s.syncStatus){s.setSyncStatus('syncing'),s.setSyncError(null);try{console.log('[SyncService] Starting sync...');const[c,n,o,l,u]=await Promise.all([e.carBrandApi.getAll().catch(()=>({data:[]})),e.carModelApi.getAll().catch(()=>({data:[]})),e.productBrandApi.getAll().catch(()=>({data:[]})),e.categoryApi.getAll().catch(()=>({data:[]})),e.productApi.getAll({limit:1e3}).catch(()=>({data:{products:[]}}))]);s.setCarBrands(c.data||[]),s.setCarModels(n.data||[]),s.setProductBrands(o.data||[]),s.setCategories(l.data||[]),s.setProducts(u.data?.products||[]);const S=s.userRole;if(['owner','partner'].includes(S))try{const[t,c,n,o]=await Promise.all([e.supplierApi.getAll().catch(()=>({data:[]})),e.distributorApi.getAll().catch(()=>({data:[]})),e.orderApi.getAllAdmin().catch(()=>({data:{orders:[]}})),e.customerApi.getAll().catch(()=>({data:{customers:[]}}))]);s.setSuppliers(t.data||[]),s.setDistributors(c.data||[]),s.setOrders(n.data?.orders||[]),s.setCustomers(o.data?.customers||[])}catch(t){console.log('[SyncService] Could not fetch privileged data:',t)}else if(['admin','subscriber'].includes(S))try{const[t,c]=await Promise.all([e.supplierApi.getAll().catch(()=>({data:[]})),e.distributorApi.getAll().catch(()=>({data:[]}))]);s.setSuppliers(t.data||[]),s.setDistributors(c.data||[])}catch(t){console.log('[SyncService] Could not fetch supplier/distributor data:',t)}s.setSyncStatus('success'),s.setLastSyncTime(Date.now()),console.log('[SyncService] Sync completed successfully'),setTimeout(()=>{'success'===t.useAppStore.getState().syncStatus&&t.useAppStore.getState().setSyncStatus('idle')},3e3)}catch(e){console.error('[SyncService] Sync failed:',e),s.setSyncStatus('error'),s.setSyncError(e.message||'Sync failed'),s.addNotification({id:`sync-error-${Date.now()}`,user_id:s.user?.id||'system',title:'Sync Failed',message:`Failed to sync data: ${e.message||'Unknown error'}`,type:'error',read:!1,created_at:(new Date).toISOString()}),setTimeout(()=>{'error'===t.useAppStore.getState().syncStatus&&t.useAppStore.getState().setSyncStatus('idle')},5e3)}}else console.log('[SyncService] Already syncing, skipping');else console.log('[SyncService] Offline, skipping sync')}forceSync(){return this.performSync()}setSyncInterval(t){this.syncIntervalMs=t,this.isRunning&&(this.stop(),this.start())}},c=()=>({start:()=>s.start(),stop:()=>s.stop(),forceSync:()=>s.forceSync(),setSyncInterval:t=>s.setSyncInterval(t)});var n=s});","lineCount":1,"map":[[1,92,204,0,"Object"],[1,99,204,0,"defineProperty"],[1,114,204,0,"_e"],[1,117,204,0],[1,128,204,0,"enumerable"],[1,140,204,0],[1,142,204,0,"get"],[1,146,204,0],[1,164,204,0,"_default"],[1,165,204,0],[1,169,192,0,"Object"],[1,176,192,0,"defineProperty"],[1,191,192,0,"_e"],[1,194,192,0],[1,209,192,0,"enumerable"],[1,221,192,0],[1,223,192,0,"get"],[1,227,192,0],[1,245,192,0,"syncService"],[1,246,192,0],[1,250,195,0,"Object"],[1,257,195,0,"defineProperty"],[1,272,195,0,"_e"],[1,275,195,0],[1,293,195,0,"enumerable"],[1,305,195,0],[1,307,195,0,"get"],[1,311,195,0],[1,329,195,0,"useSyncService"],[1,330,195,0],[1,334,5,0],[1,338,5,0,"_storeAppStore"],[1,340,5,0,"r"],[1,342,5,0,"d"],[1,344,5,0],[1,348,6,0,"_api"],[1,350,6,0,"r"],[1,352,6,0,"d"],[1,354,6,0],[1,358,192,7],[1,364,192,13,"syncService"],[1,366,192,27],[1,370,19,0],[1,376,20,10,"syncInterval"],[1,389,20,48],[1,394,21,10,"isRunning"],[1,405,21,22],[1,407,22,10,"syncIntervalMs"],[1,422,22,27],[1,426,27,2,"start"],[1,434,28,8,"this"],[1,439,28,13,"isRunning"],[1,451,30,4,"this"],[1,456,30,9,"isRunning"],[1,467,30,21],[1,469,31,4,"console"],[1,477,31,12,"log"],[1,481,31,16],[1,531,34,4,"this"],[1,536,34,9,"performSync"],[1,550,37,4,"this"],[1,555,37,9,"syncInterval"],[1,568,37,24,"setInterval"],[1,580,37,36],[1,585,38,6,"this"],[1,590,38,11,"performSync"],[1,605,39,7,"this"],[1,610,39,12,"syncIntervalMs"],[1,626,40,2],[1,627,45,2,"stop"],[1,634,46,8,"this"],[1,639,46,13,"syncInterval"],[1,654,47,6,"clearInterval"],[1,668,47,20,"this"],[1,673,47,25,"syncInterval"],[1,687,48,6,"this"],[1,692,48,11,"syncInterval"],[1,705,48,26],[1,711,50,4,"this"],[1,716,50,9,"isRunning"],[1,727,50,21],[1,729,51,4,"console"],[1,737,51,12,"log"],[1,741,51,16],[1,789,52,2],[1,790,57,2],[1,807,57,8,"performSync"],[1,810,58,4],[1,816,58,10,"store"],[1,818,58,18,"useAppStore"],[1,820,58,29,"useAppStore"],[1,832,58,30,"getState"],[1,843,61,4],[1,846,61,9,"store"],[1,848,61,15,"isOnline"],[1,857,67,4],[1,860,67,29],[1,872,67,8,"store"],[1,874,67,14,"syncStatus"],[1,885,67,4],[1,886,72,4,"store"],[1,888,72,10,"setSyncStatus"],[1,902,72,24],[1,913,73,4,"store"],[1,915,73,10,"setSyncError"],[1,928,73,23],[1,934,75,4],[1,938,76,6,"console"],[1,946,76,14,"log"],[1,950,76,18],[1,984,79,6],[1,990,80,8,"carBrandsRes"],[1,992,81,8,"carModelsRes"],[1,994,82,8,"productBrandsRes"],[1,996,83,8,"categoriesRes"],[1,998,84,8,"productsRes"],[1,1007,85,16,"Promise"],[1,1015,85,24,"all"],[1,1019,85,28],[1,1020,86,8,"carBrandApi"],[1,1022,86,19,"carBrandApi"],[1,1034,86,20,"getAll"],[1,1043,86,29,"catch"],[1,1049,86,35],[1,1055,86,44,"data"],[1,1060,86,50],[1,1066,87,8,"carModelApi"],[1,1068,87,19,"carModelApi"],[1,1080,87,20,"getAll"],[1,1089,87,29,"catch"],[1,1095,87,35],[1,1101,87,44,"data"],[1,1106,87,50],[1,1112,88,8,"productBrandApi"],[1,1114,88,23,"productBrandApi"],[1,1130,88,24,"getAll"],[1,1139,88,33,"catch"],[1,1145,88,39],[1,1151,88,48,"data"],[1,1156,88,54],[1,1162,89,8,"categoryApi"],[1,1164,89,19,"categoryApi"],[1,1176,89,20,"getAll"],[1,1185,89,29,"catch"],[1,1191,89,35],[1,1197,89,44,"data"],[1,1202,89,50],[1,1208,90,8,"productApi"],[1,1210,90,18,"productApi"],[1,1221,90,19,"getAll"],[1,1228,90,26],[1,1229,90,28,"limit"],[1,1235,90,35],[1,1241,90,43,"catch"],[1,1247,90,49],[1,1253,90,58,"data"],[1,1258,90,64],[1,1259,90,66,"products"],[1,1268,90,76],[1,1277,94,6,"store"],[1,1279,94,12,"setCarBrands"],[1,1292,94,25,"carBrandsRes"],[1,1294,94,38,"data"],[1,1300,94,46],[1,1304,95,6,"store"],[1,1306,95,12,"setCarModels"],[1,1319,95,25,"carModelsRes"],[1,1321,95,38,"data"],[1,1327,95,46],[1,1331,96,6,"store"],[1,1333,96,12,"setProductBrands"],[1,1350,96,29,"productBrandsRes"],[1,1352,96,46,"data"],[1,1358,96,54],[1,1362,97,6,"store"],[1,1364,97,12,"setCategories"],[1,1378,97,26,"categoriesRes"],[1,1380,97,40,"data"],[1,1386,97,48],[1,1390,98,6,"store"],[1,1392,98,12,"setProducts"],[1,1404,98,24,"productsRes"],[1,1406,98,36,"data"],[1,1412,98,42,"products"],[1,1422,98,54],[1,1426,101,6],[1,1432,101,12,"userRole"],[1,1434,101,23,"store"],[1,1436,101,29,"userRole"],[1,1445,102,6],[1,1448,102,10],[1,1449,102,11],[1,1457,102,20],[1,1468,102,31,"includes"],[1,1477,102,40,"userRole"],[1,1480,103,8],[1,1484,104,10],[1,1490,105,12,"suppliersRes"],[1,1492,106,12,"distributorsRes"],[1,1494,107,12,"ordersRes"],[1,1496,108,12,"customersRes"],[1,1505,109,20,"Promise"],[1,1513,109,28,"all"],[1,1517,109,32],[1,1518,110,12,"supplierApi"],[1,1520,110,23,"supplierApi"],[1,1532,110,24,"getAll"],[1,1541,110,33,"catch"],[1,1547,110,39],[1,1553,110,48,"data"],[1,1558,110,54],[1,1564,111,12,"distributorApi"],[1,1566,111,26,"distributorApi"],[1,1581,111,27,"getAll"],[1,1590,111,36,"catch"],[1,1596,111,42],[1,1602,111,51,"data"],[1,1607,111,57],[1,1613,112,12,"orderApi"],[1,1615,112,20,"orderApi"],[1,1624,112,21,"getAllAdmin"],[1,1638,112,35,"catch"],[1,1644,112,41],[1,1650,112,50,"data"],[1,1655,112,56],[1,1656,112,58,"orders"],[1,1663,112,66],[1,1670,113,12,"customerApi"],[1,1672,113,23,"customerApi"],[1,1684,113,24,"getAll"],[1,1693,113,33,"catch"],[1,1699,113,39],[1,1705,113,48,"data"],[1,1710,113,54],[1,1711,113,56,"customers"],[1,1721,113,67],[1,1730,116,10,"store"],[1,1732,116,16,"setSuppliers"],[1,1745,116,29,"suppliersRes"],[1,1747,116,42,"data"],[1,1753,116,50],[1,1757,117,10,"store"],[1,1759,117,16,"setDistributors"],[1,1775,117,32,"distributorsRes"],[1,1777,117,48,"data"],[1,1783,117,56],[1,1787,118,10,"store"],[1,1789,118,16,"setOrders"],[1,1799,118,26,"ordersRes"],[1,1801,118,36,"data"],[1,1807,118,42,"orders"],[1,1815,118,52],[1,1819,119,10,"store"],[1,1821,119,16,"setCustomers"],[1,1834,119,29,"customersRes"],[1,1836,119,42,"data"],[1,1842,119,48,"customers"],[1,1853,119,61],[1,1856,120,8],[1,1857,120,10],[1,1863,120,17,"e"],[1,1866,121,10,"console"],[1,1874,121,18,"log"],[1,1878,121,22],[1,1927,121,72,"e"],[1,1929,122,8],[1,1935,123,13],[1,1938,123,17],[1,1939,123,18],[1,1947,123,27],[1,1961,123,41,"includes"],[1,1970,123,50,"userRole"],[1,1973,124,8],[1,1977,125,10],[1,1983,125,17,"suppliersRes"],[1,1985,125,31,"distributorsRes"],[1,1994,125,56,"Promise"],[1,2002,125,64,"all"],[1,2006,125,68],[1,2007,126,12,"supplierApi"],[1,2009,126,23,"supplierApi"],[1,2021,126,24,"getAll"],[1,2030,126,33,"catch"],[1,2036,126,39],[1,2042,126,48,"data"],[1,2047,126,54],[1,2053,127,12,"distributorApi"],[1,2055,127,26,"distributorApi"],[1,2070,127,27,"getAll"],[1,2079,127,36,"catch"],[1,2085,127,42],[1,2091,127,51,"data"],[1,2096,127,57],[1,2104,129,10,"store"],[1,2106,129,16,"setSuppliers"],[1,2119,129,29,"suppliersRes"],[1,2121,129,42,"data"],[1,2127,129,50],[1,2131,130,10,"store"],[1,2133,130,16,"setDistributors"],[1,2149,130,32,"distributorsRes"],[1,2151,130,48,"data"],[1,2157,130,56],[1,2160,131,8],[1,2161,131,10],[1,2167,131,17,"e"],[1,2170,132,10,"console"],[1,2178,132,18,"log"],[1,2182,132,22],[1,2241,132,82,"e"],[1,2243,133,8],[1,2244,136,6,"store"],[1,2246,136,12,"setSyncStatus"],[1,2260,136,26],[1,2271,137,6,"store"],[1,2273,137,12,"setLastSyncTime"],[1,2289,137,28,"Date"],[1,2294,137,33,"now"],[1,2301,138,6,"console"],[1,2309,138,14,"log"],[1,2313,138,18],[1,2358,141,6,"setTimeout"],[1,2369,141,17],[1,2374,142,50],[1,2386,142,12,"useAppStore"],[1,2388,142,23,"useAppStore"],[1,2400,142,24,"getState"],[1,2411,142,35,"syncStatus"],[1,2423,143,10,"useAppStore"],[1,2425,143,21,"useAppStore"],[1,2437,143,22,"getState"],[1,2448,143,33,"setSyncStatus"],[1,2462,143,47],[1,2471,145,9],[1,2475,147,4],[1,2476,147,6],[1,2482,147,13,"error"],[1,2485,148,6,"console"],[1,2493,148,14,"error"],[1,2499,148,20],[1,2528,148,50,"error"],[1,2531,149,6,"store"],[1,2533,149,12,"setSyncStatus"],[1,2547,149,26],[1,2556,150,6,"store"],[1,2558,150,12,"setSyncError"],[1,2571,150,25,"error"],[1,2573,150,31,"message"],[1,2582,150,42],[1,2597,153,6,"store"],[1,2599,153,12,"addNotification"],[1,2615,153,28],[1,2616,154,8,"id"],[1,2619,154,12],[1,2633,154,26,"Date"],[1,2638,154,31,"now"],[1,2646,155,8,"user_id"],[1,2654,155,17,"store"],[1,2656,155,23,"user"],[1,2662,155,29,"id"],[1,2666,155,35],[1,2675,156,8,"title"],[1,2681,156,15],[1,2695,157,8,"message"],[1,2703,157,17],[1,2727,157,41,"error"],[1,2729,157,47,"message"],[1,2738,157,58],[1,2756,158,8,"type"],[1,2761,158,14],[1,2769,159,8,"read"],[1,2775,159,14],[1,2777,160,8,"created_at"],[1,2789,160,20],[1,2793,160,24,"Date"],[1,2799,160,31,"toISOString"],[1,2815,164,6,"setTimeout"],[1,2826,164,17],[1,2831,165,50],[1,2841,165,12,"useAppStore"],[1,2843,165,23,"useAppStore"],[1,2855,165,24,"getState"],[1,2866,165,35,"syncStatus"],[1,2878,166,10,"useAppStore"],[1,2880,166,21,"useAppStore"],[1,2892,166,22,"getState"],[1,2903,166,33,"setSyncStatus"],[1,2917,166,47],[1,2926,168,9],[1,2930,169,4],[1,2931,70,4],[1,2937,68,6,"console"],[1,2945,68,14,"log"],[1,2949,68,18],[1,2997,62,6,"console"],[1,3005,62,14,"log"],[1,3009,62,18],[1,3048,170,2],[1,3049,175,2,"forceSync"],[1,3061,176,4],[1,3068,176,11,"this"],[1,3073,176,16,"performSync"],[1,3086,177,2],[1,3087,182,2,"setSyncInterval"],[1,3103,182,18,"ms"],[1,3106,183,4,"this"],[1,3111,183,9,"syncIntervalMs"],[1,3126,183,26,"ms"],[1,3128,184,8,"this"],[1,3133,184,13,"isRunning"],[1,3145,185,6,"this"],[1,3150,185,11,"stop"],[1,3157,186,6,"this"],[1,3162,186,11,"start"],[1,3170,188,2],[1,3173,195,13,"useSyncService"],[1,3175,195,30,"useSyncService"],[1,3180,196,9],[1,3181,197,4,"start"],[1,3187,197,11,"start"],[1,3191,197,17,"syncService"],[1,3193,197,29,"start"],[1,3201,198,4,"stop"],[1,3206,198,10,"stop"],[1,3210,198,16,"syncService"],[1,3212,198,28,"stop"],[1,3219,199,4,"forceSync"],[1,3229,199,15,"forceSync"],[1,3233,199,21,"syncService"],[1,3235,199,33,"forceSync"],[1,3247,200,4,"setSyncInterval"],[1,3263,200,22,"ms"],[1,3266,200,37,"syncService"],[1,3268,200,49,"setSyncInterval"],[1,3284,200,65,"ms"],[1,3289,204,0],[1,3293,204,0,"_default"],[1,3295,204,15,"syncService"],[1,3296,204,27],[1,3299]],"functionMap":{"names":["<global>","SyncService","SyncService#start","setInterval$argument_0","SyncService#stop","SyncService#performSync","carBrandApi.getAll._catch$argument_0","carModelApi.getAll._catch$argument_0","productBrandApi.getAll._catch$argument_0","categoryApi.getAll._catch$argument_0","productApi.getAll._catch$argument_0","supplierApi.getAll._catch$argument_0","distributorApi.getAll._catch$argument_0","orderApi.getAllAdmin._catch$argument_0","customerApi.getAll._catch$argument_0","setTimeout$argument_0","SyncService#forceSync","SyncService#setSyncInterval","useSyncService","start","stop","forceSync","setSyncInterval"],"mappings":"AAA;ACkB;ECQ;oCCU;KDE;GDC;EGK;GHO;EIK;mCC6B,oBD;mCEC,oBF;uCGC,oBH;mCIC,oBJ;iDKC,kCL;uCMoB,oBN;0COC,oBP;yCQC,gCR;uCSC,mCT;uCMa,oBN;0COC,oBP;iBUc;OVI;iBUmB;OVI;GJE;EeK;GfE;EgBK;GhBM;CDC;8BkBM;WCE,yBD;UEC,wBF;eGC,6BH;qBIC,+CJ;ClBE"},"hasCjsExports":false},"type":"js/module"}]}