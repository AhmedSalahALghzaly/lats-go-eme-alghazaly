{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":57},"end":{"line":4,"column":55,"index":112}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"../store/appStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":113},"end":{"line":5,"column":48,"index":161}}],"key":"/bohzyw2mCiLwBL1LhK3cj9dt4o=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){\"use strict\";Object.defineProperty(e,'__esModule',{value:!0}),Object.defineProperty(e,\"default\",{enumerable:!0,get:function(){return l}}),Object.defineProperty(e,\"wsService\",{enumerable:!0,get:function(){return c}}),Object.defineProperty(e,\"useWebSocket\",{enumerable:!0,get:function(){return o}});var t=r(d[0]),s=r(d[1]);const n=process.env.EXPO_PUBLIC_API_URL?.replace(/^http/,'ws')||'ws://localhost:8001';const c=new class{ws=null;reconnectTimeout=null;reconnectAttempts=0;maxReconnectAttempts=5;messageHandlers=new Set;connect(t){if(this.ws?.readyState===WebSocket.OPEN)return;const s=t?`${n}/api/ws?user_id=${t}`:`${n}/api/ws`;try{this.ws=new WebSocket(s),this.ws.onopen=()=>{console.log('[WS] Connected'),this.reconnectAttempts=0},this.ws.onmessage=t=>{try{const s=JSON.parse(t.data);console.log('[WS] Message:',s),this.messageHandlers.forEach(t=>t(s))}catch(t){console.error('[WS] Parse error:',t)}},this.ws.onerror=t=>{console.error('[WS] Error:',t)},this.ws.onclose=()=>{console.log('[WS] Disconnected'),this.scheduleReconnect(t)}}catch(s){console.error('[WS] Connection error:',s),this.scheduleReconnect(t)}}scheduleReconnect(t){if(this.reconnectAttempts>=this.maxReconnectAttempts)return void console.log('[WS] Max reconnect attempts reached');this.reconnectTimeout&&clearTimeout(this.reconnectTimeout);const s=Math.min(1e3*Math.pow(2,this.reconnectAttempts),3e4);this.reconnectAttempts++,this.reconnectTimeout=setTimeout(()=>{console.log(`[WS] Reconnecting (attempt ${this.reconnectAttempts})...`),this.connect(t)},s)}disconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.ws&&(this.ws.close(),this.ws=null)}send(t){this.ws?.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(t))}addMessageHandler(t){return this.messageHandlers.add(t),()=>this.messageHandlers.delete(t)}isConnected(){return this.ws?.readyState===WebSocket.OPEN}},o=()=>{const n=(0,s.useAppStore)(t=>t.user),o=(0,s.useAppStore)(t=>t.addNotification),l=(0,s.useAppStore)(t=>t.setSyncStatus),u=(0,s.useAppStore)(t=>t.fetchInitialData);(0,t.useEffect)(()=>{c.connect(n?.id);const t=c.addMessageHandler(t=>{switch(t.type){case'notification':t.data&&o({id:t.data.id||`notif-${Date.now()}`,title:t.data.title,message:t.data.message,type:t.data.type||'info',read:!1,created_at:t.data.created_at||(new Date).toISOString()});break;case'sync':l('syncing'),u?.().then(()=>{l('success'),setTimeout(()=>l('idle'),2e3)}).catch(()=>{l('error')});break;case'ping':c.send({type:'pong'});break;default:console.log('[WS] Unknown message type:',t.type)}});return()=>{t(),c.disconnect()}},[n?.id]);const h=(0,t.useCallback)(t=>{c.send(t)},[]);return{isConnected:c.isConnected(),sendMessage:h}};var l=c});","lineCount":1,"map":[[1,90,168,0,"Object"],[1,97,168,0,"defineProperty"],[1,112,168,0,"e"],[1,114,168,0],[1,125,168,0,"enumerable"],[1,137,168,0],[1,139,168,0,"get"],[1,143,168,0],[1,161,168,0,"_default"],[1,162,168,0],[1,166,102,0,"Object"],[1,173,102,0,"defineProperty"],[1,188,102,0,"e"],[1,190,102,0],[1,203,102,0,"enumerable"],[1,215,102,0],[1,217,102,0,"get"],[1,221,102,0],[1,239,102,0,"wsService"],[1,240,102,0],[1,244,105,0,"Object"],[1,251,105,0,"defineProperty"],[1,266,105,0,"e"],[1,268,105,0],[1,284,105,0,"enumerable"],[1,296,105,0],[1,298,105,0,"get"],[1,302,105,0],[1,320,105,0,"useWebSocket"],[1,321,105,0],[1,325,4,0],[1,329,4,0,"_react"],[1,331,4,0,"r"],[1,333,4,0,"d"],[1,335,4,0],[1,339,5,0,"_storeAppStore"],[1,341,5,0,"r"],[1,343,5,0,"d"],[1,345,5,0],[1,349,7,0],[1,355,7,6,"WS_URL"],[1,357,7,15,"process"],[1,365,7,23,"env"],[1,369,7,27,"EXPO_PUBLIC_API_URL"],[1,390,7,48,"replace"],[1,398,7,56],[1,406,7,65],[1,413,7,74],[1,435,102,7],[1,441,102,13,"wsService"],[1,443,102,25],[1,447,9,0],[1,453,10,10,"ws"],[1,456,10,33],[1,461,11,10,"reconnectTimeout"],[1,478,11,52],[1,483,12,10,"reconnectAttempts"],[1,501,12,30],[1,503,13,10,"maxReconnectAttempts"],[1,524,13,33],[1,526,14,10,"messageHandlers"],[1,542,14,54],[1,546,14,58,"Set"],[1,550,16,2,"connect"],[1,558,16,10,"userId"],[1,561,17,4],[1,564,17,8,"this"],[1,569,17,13,"ws"],[1,573,17,17,"readyState"],[1,586,17,32,"WebSocket"],[1,596,17,42,"OPEN"],[1,601,18,6],[1,608,21,4],[1,614,21,10,"url"],[1,616,21,16,"userId"],[1,618,21,25],[1,621,21,28,"WS_URL"],[1,641,21,53,"userId"],[1,645,21,64],[1,648,21,67,"WS_URL"],[1,659,23,4],[1,663,24,6,"this"],[1,668,24,11,"ws"],[1,671,24,16],[1,675,24,20,"WebSocket"],[1,685,24,30,"url"],[1,688,26,6,"this"],[1,693,26,11,"ws"],[1,696,26,14,"onopen"],[1,703,26,23],[1,708,27,8,"console"],[1,716,27,16,"log"],[1,720,27,20],[1,738,28,8,"this"],[1,743,28,13,"reconnectAttempts"],[1,761,28,33],[1,764,31,6,"this"],[1,769,31,11,"ws"],[1,772,31,14,"onmessage"],[1,782,31,27,"event"],[1,786,32,8],[1,790,33,10],[1,796,33,16,"data"],[1,798,33,23,"JSON"],[1,803,33,28,"parse"],[1,809,33,34,"event"],[1,811,33,40,"data"],[1,817,34,10,"console"],[1,825,34,18,"log"],[1,829,34,22],[1,845,34,39,"data"],[1,848,35,10,"this"],[1,853,35,15,"messageHandlers"],[1,869,35,31,"forEach"],[1,877,35,39,"handler"],[1,880,35,50,"handler"],[1,882,35,58,"data"],[1,885,36,8],[1,886,36,10],[1,892,36,17,"err"],[1,895,37,10,"console"],[1,903,37,18,"error"],[1,909,37,24],[1,929,37,45,"err"],[1,931,38,8],[1,934,41,6,"this"],[1,939,41,11,"ws"],[1,942,41,14,"onerror"],[1,950,41,25,"error"],[1,954,42,8,"console"],[1,962,42,16,"error"],[1,968,42,22],[1,982,42,37,"error"],[1,986,45,6,"this"],[1,991,45,11,"ws"],[1,994,45,14,"onclose"],[1,1002,45,24],[1,1007,46,8,"console"],[1,1015,46,16,"log"],[1,1019,46,20],[1,1040,47,8,"this"],[1,1045,47,13,"scheduleReconnect"],[1,1063,47,31,"userId"],[1,1066,49,4],[1,1067,49,6],[1,1073,49,13,"err"],[1,1076,50,6,"console"],[1,1084,50,14,"error"],[1,1090,50,20],[1,1115,50,46,"err"],[1,1118,51,6,"this"],[1,1123,51,11,"scheduleReconnect"],[1,1141,51,29,"userId"],[1,1143,52,4],[1,1144,53,2],[1,1145,55,10,"scheduleReconnect"],[1,1163,55,28,"userId"],[1,1166,56,4],[1,1169,56,8,"this"],[1,1174,56,13,"reconnectAttempts"],[1,1193,56,34,"this"],[1,1198,56,39,"maxReconnectAttempts"],[1,1219,58,6],[1,1231,57,6,"console"],[1,1239,57,14,"log"],[1,1243,57,18],[1,1282,61,8,"this"],[1,1287,61,13,"reconnectTimeout"],[1,1305,62,6,"clearTimeout"],[1,1318,62,19,"this"],[1,1323,62,24,"reconnectTimeout"],[1,1341,65,4],[1,1347,65,10,"delay"],[1,1349,65,18,"Math"],[1,1354,65,23,"min"],[1,1358,65,27],[1,1362,65,34,"Math"],[1,1367,65,39,"pow"],[1,1371,65,43],[1,1373,65,46,"this"],[1,1378,65,51,"reconnectAttempts"],[1,1397,65,71],[1,1402,66,4,"this"],[1,1407,66,9,"reconnectAttempts"],[1,1427,68,4,"this"],[1,1432,68,9,"reconnectTimeout"],[1,1449,68,28,"setTimeout"],[1,1460,68,39],[1,1465,69,6,"console"],[1,1473,69,14,"log"],[1,1477,69,18],[1,1507,69,48,"this"],[1,1512,69,53,"reconnectAttempts"],[1,1537,70,6,"this"],[1,1542,70,11,"connect"],[1,1550,70,19,"userId"],[1,1554,71,7,"delay"],[1,1556,72,2],[1,1557,74,2,"disconnect"],[1,1570,75,8,"this"],[1,1575,75,13,"reconnectTimeout"],[1,1594,76,6,"clearTimeout"],[1,1607,76,19,"this"],[1,1612,76,24,"reconnectTimeout"],[1,1630,77,6,"this"],[1,1635,77,11,"reconnectTimeout"],[1,1652,77,30],[1,1658,80,8,"this"],[1,1663,80,13,"ws"],[1,1668,81,6,"this"],[1,1673,81,11,"ws"],[1,1676,81,14,"close"],[1,1684,82,6,"this"],[1,1689,82,11,"ws"],[1,1692,82,16],[1,1697,84,2],[1,1698,86,2,"send"],[1,1703,86,7,"data"],[1,1706,87,8,"this"],[1,1711,87,13,"ws"],[1,1715,87,17,"readyState"],[1,1728,87,32,"WebSocket"],[1,1738,87,42,"OPEN"],[1,1744,88,6,"this"],[1,1749,88,11,"ws"],[1,1752,88,14,"send"],[1,1757,88,19,"JSON"],[1,1762,88,24,"stringify"],[1,1772,88,34,"data"],[1,1775,90,2],[1,1776,92,2,"addMessageHandler"],[1,1794,92,20,"handler"],[1,1797,94,4],[1,1804,93,4,"this"],[1,1809,93,9,"messageHandlers"],[1,1825,93,25,"add"],[1,1829,93,29,"handler"],[1,1832,94,11],[1,1836,94,17,"this"],[1,1841,94,22,"messageHandlers"],[1,1857,94,38,"delete"],[1,1864,94,45,"handler"],[1,1866,95,2],[1,1867,97,2,"isConnected"],[1,1881,98,4],[1,1888,98,11,"this"],[1,1893,98,16,"ws"],[1,1897,98,20,"readyState"],[1,1910,98,35,"WebSocket"],[1,1920,98,45,"OPEN"],[1,1924,99,2],[1,1927,105,13,"useWebSocket"],[1,1929,105,28,"useWebSocket"],[1,1934,106,2],[1,1940,106,8,"user"],[1,1943,106,15],[1,1945,106,15,"useAppStore"],[1,1947,106,26,"useAppStore"],[1,1960,106,28,"state"],[1,1963,106,38,"state"],[1,1965,106,44,"user"],[1,1971,107,8,"addNotification"],[1,1974,107,26],[1,1976,107,26,"useAppStore"],[1,1978,107,37,"useAppStore"],[1,1991,107,39,"state"],[1,1994,107,49,"state"],[1,1996,107,55,"addNotification"],[1,2013,108,8,"setSyncStatus"],[1,2016,108,24],[1,2018,108,24,"useAppStore"],[1,2020,108,35,"useAppStore"],[1,2033,108,37,"state"],[1,2036,108,47,"state"],[1,2038,108,53,"setSyncStatus"],[1,2053,109,8,"fetchData"],[1,2056,109,20],[1,2058,109,20,"useAppStore"],[1,2060,109,31,"useAppStore"],[1,2073,109,33,"state"],[1,2076,109,43,"state"],[1,2078,109,49,"fetchInitialData"],[1,2097,111,2],[1,2099,111,2,"useEffect"],[1,2101,111,11,"useEffect"],[1,2112,111,12],[1,2117,113,4,"wsService"],[1,2119,113,14,"connect"],[1,2127,113,22,"user"],[1,2130,113,28,"id"],[1,2134,116,4],[1,2140,116,10,"removeHandler"],[1,2142,116,26,"wsService"],[1,2144,116,36,"addMessageHandler"],[1,2162,116,55,"data"],[1,2166,117,6],[1,2173,117,14,"data"],[1,2175,117,19,"type"],[1,2181,118,8],[1,2185,118,13],[1,2200,120,14,"data"],[1,2202,120,19,"data"],[1,2208,121,12,"addNotification"],[1,2210,121,28],[1,2211,122,14,"id"],[1,2214,122,18,"data"],[1,2216,122,23,"data"],[1,2221,122,28,"id"],[1,2225,122,34],[1,2234,122,43,"Date"],[1,2239,122,48,"now"],[1,2247,123,14,"title"],[1,2253,123,21,"data"],[1,2255,123,26,"data"],[1,2260,123,31,"title"],[1,2266,124,14,"message"],[1,2274,124,23,"data"],[1,2276,124,28,"data"],[1,2281,124,33,"message"],[1,2289,125,14,"type"],[1,2294,125,20,"data"],[1,2296,125,25,"data"],[1,2301,125,30,"type"],[1,2307,125,38],[1,2314,126,14,"read"],[1,2320,126,20],[1,2322,127,14,"created_at"],[1,2333,127,26,"data"],[1,2335,127,31,"data"],[1,2340,127,36,"created_at"],[1,2353,127,50],[1,2357,127,54,"Date"],[1,2363,127,61,"toISOString"],[1,2379,130,10],[1,2385,132,8],[1,2389,132,13],[1,2396,134,10,"setSyncStatus"],[1,2398,134,24],[1,2409,135,10,"fetchData"],[1,2415,135,24,"then"],[1,2420,135,29],[1,2425,136,12,"setSyncStatus"],[1,2427,136,26],[1,2438,137,12,"setTimeout"],[1,2449,137,23],[1,2453,137,29,"setSyncStatus"],[1,2455,137,43],[1,2463,137,52],[1,2470,138,13,"catch"],[1,2476,138,19],[1,2481,139,12,"setSyncStatus"],[1,2483,139,26],[1,2494,141,10],[1,2500,143,8],[1,2504,143,13],[1,2511,144,10,"wsService"],[1,2513,144,20,"send"],[1,2518,144,25],[1,2519,144,27,"type"],[1,2524,144,33],[1,2533,145,10],[1,2539,147,8],[1,2547,148,10,"console"],[1,2555,148,18,"log"],[1,2559,148,22],[1,2588,148,52,"data"],[1,2590,148,57,"type"],[1,2599,152,4],[1,2605,152,11],[1,2610,153,6,"removeHandler"],[1,2614,154,6,"wsService"],[1,2616,154,16,"disconnect"],[1,2631,156,5],[1,2632,156,6,"user"],[1,2635,156,12,"id"],[1,2640,158,2],[1,2646,158,8,"sendMessage"],[1,2649,158,22],[1,2651,158,22,"useCallback"],[1,2653,158,33,"useCallback"],[1,2666,158,35,"data"],[1,2670,159,4,"wsService"],[1,2672,159,14,"send"],[1,2677,159,19,"data"],[1,2681,160,5],[1,2685,162,2],[1,2691,162,9],[1,2692,163,4,"isConnected"],[1,2704,163,17,"wsService"],[1,2706,163,27,"isConnected"],[1,2720,164,4,"sendMessage"],[1,2736,168,0],[1,2740,168,0,"_default"],[1,2742,168,15,"wsService"],[1,2743,168,25],[1,2746]],"functionMap":{"names":["<global>","WebSocketService","WebSocketService#connect","ws.onopen","ws.onmessage","messageHandlers.forEach$argument_0","ws.onerror","ws.onclose","WebSocketService#scheduleReconnect","setTimeout$argument_0","WebSocketService#disconnect","WebSocketService#send","WebSocketService#addMessageHandler","<anonymous>","WebSocketService#isConnected","useWebSocket","useAppStore$argument_0","useEffect$argument_0","wsService.addMessageHandler$argument_0","fetchData.then$argument_0","fetchData.then._catch$argument_0","sendMessage"],"mappings":"AAA;ACQ;ECO;uBCU;ODG;0BEE;uCCI,wBD;OFI;wBIE;OJE;wBKE;OLG;GDK;EOE;uCCa;KDG;GPC;ESE;GTU;EUE;GVI;EWE;WCE,0CD;GXC;EaE;GbE;CDC;4BeK;2BCC,qBD;sCCC,gCD;oCCC,8BD;gCCC,iCD;YEE;sDCK;6BCmB;uBVE,2BU;WDC,QE;WFE;KDU;WJE;KIG;GFC;kCME;GNE;CfM"},"hasCjsExports":false},"type":"js/module"}]}